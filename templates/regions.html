{% extends "_base.html" %}
{% load static %}
{% load i18n %}

{% block pagetitle %}{% translate "Region" %}s{% endblock %}

{% block pagelevelcss %}
        <link href="{% static "assets/plugins/custom/datatables/datatables.bundle.css" %}" rel="stylesheet" type="text/css" />
{% endblock %}

{% block pagelevelplugins %}
        <script src="{% static "assets/plugins/custom/datatables/datatables.bundle.js" %}" type="text/javascript"></script>
{% endblock %}

{% block menu_regions %}kt-menu__item--active{% endblock %}

{% block corpsdepage %}
    <div class="kt-portlet">
        <div class="kt-portlet__head">
            <div class="kt-portlet__head-label">
                <span class="kt-portlet__head-icon">
                    <i class="fa fa-book"></i>
                </span>
                <h3 class="kt-portlet__head-title">
                    {% translate "Region" %}s
                </h3>
            </div>
        </div>
        <div class="kt-portlet__body">
            <table class="table table-bordered table-hover table-sm" id="regions">
                <thead class="thead-dark">
                    <tr>
                        <th class="kt-font-light">{% translate "Name" %}</th>
                        <th class="kt-font-light">{% translate "Land" %}</th>
                        <th class="kt-font-light">{% translate "Difficulty" %}</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}

{% block js %}
    <style>
        .popover {
            min-width: 30em !important;
        }
    </style>

    <script>
        $(document).ready(function () {

            const oTable = $('#regions').DataTable({
                "processing": true,
                "serverSide": true,
                "paging": false,
                "info": false,
                "ajax": "{% url 'regions_ws' %}",
                "lengthMenu": [[20, 50, 100, 500, -1], [20, 50, 100, 500, "Tout"]],
                "columnDefs": [
                    {
                        orderable: true,
                        "targets": [0, 1, 2]
                    },
                    {
                        searchable: true,
                        "targets": [0, 1, 2]
                    }
                ],
                "order": [[0, 'asc']],
            });

            var popoverRemoteContents = function (element) {
                if ($(element).data('loaded') !== true) {
                    var div_id = 'tmp-id-' + $.now();
                    $.ajax({
                        url: $(element).data('popover-remote'),
                        success: function (response) {
                            $('#' + div_id).html(response);
                            $(element).attr("data-loaded", true);
                            $(element).attr("data-content", response);
                            return $(element).popover('update');
                        }
                    });
                    return '<div id="' + div_id + '">{% translate "Loading..." %}</div>';
                } else {
                    return $(element).data('content');
                }
            };

            $('[data-popover-remote]')
                .click(false)
                .popover({
                    html: true,
                    trigger: 'hover',
                    sanitize: false,
                    container: 'body',
                    content: function () {
                        return popoverRemoteContents(this);
                    }
                });
        });
    </script>
{% endblock %}
